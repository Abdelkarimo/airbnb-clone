<div class="listing-detail-container">
  <!-- Loading state -->
  <div *ngIf="loading" class="loading glass-card">
    <div class="spinner"></div>
    <p>Loading listing details...</p>
  </div>

  <!-- Error state -->
  <div *ngIf="error && !loading" class="error glass-card">
    <div class="error-content">
      <i class="bi bi-exclamation-triangle"></i>
      <p>{{ error }}</p>
    </div>
    <button class="glass-btn" (click)="goBack()">
      <i class="bi bi-arrow-left"></i>Back to Listings
    </button>
  </div>

  <!-- Content -->
  <div *ngIf="listing && !loading && !error" class="detail-content">

    <div class="detail-header glass-card">
      <div class="header-content">
        <h3>{{ listing.title }}</h3>
        <div class="wrap">
          <button class="btn btn-sm fav-btn">
            <i class="bi bi-heart-fill"></i>
          </button>
        </div>
      </div>
    </div>
    <div class="content-grid">
      <!-- Compact Images Section -->
      <div class="images-section glass-card">
        <div class="main-image">
          <img [src]="listing.images && listing.images.length > 0 
              ? listing.images[currentImageIndex].imageUrl 
              : 'https://via.placeholder.com/800x600?text=No+Image'" [alt]="listing.title" />

          <button *ngIf="listing.images && listing.images.length > 1" class="nav-btn prev" (click)="prevImage()">
            <i class="bi bi-chevron-left"></i>
          </button>
          <button *ngIf="listing.images && listing.images.length > 1" class="nav-btn next" (click)="nextImage()">
            <i class="bi bi-chevron-right"></i>
          </button>

          <!-- Image Counter -->
          <div *ngIf="listing.images && listing.images.length > 1" class="image-counter">
            {{ currentImageIndex + 1 }} / {{ listing.images.length }}
          </div>
        </div>

        <!-- Thumbnails -->
        <div *ngIf="listing.images && listing.images.length > 1" class="thumbnails">
          <button *ngFor="let img of listing.images; let i = index" class="thumbnail"
            [class.active]="i === currentImageIndex" (click)="selectImage(i)">
            <img [src]="img.imageUrl" [alt]="'Image ' + (i + 1)" />
          </button>
        </div>
      </div>

      <!-- Essential Info Card -->
      <div class="essential-info glass-card">
        <div class="price-section">
          <h2 class="price">{{ listing.pricePerNight }} EGP</h2>
          <span class="per-night">per night</span>
        </div>

        <div class="quick-details">
          <div class="detail-badge">
            <i class="bi bi-people-fill"></i>
            <span>{{ listing.maxGuests }} Guests</span>
          </div>
          <div class="detail-badge">
            <i class="bi bi-door-closed-fill"></i>
            <span>{{ listing.bedrooms || 'N/A' }} Bedrooms</span>
          </div>
          <div class="detail-badge">
            <i class="bi bi-droplet-half"></i>
            <span>{{ listing.bathrooms || 'N/A' }} Bathrooms</span>
          </div>
        </div>

        <div class="status-rating">
          <div class="status" [class.approved]="listing.isApproved" [class.pending]="!listing.isApproved">
            {{ listing.isApproved ? '✓ Approved' : '⏳ Pending' }}
          </div>
          <div class="rating" *ngIf="listing.averageRating">
            <i class="bi bi-star-fill"></i>
            <span>{{ listing.averageRating.toFixed(1) }}</span>
            <span class="count">({{ listing.reviewCount }})</span>
          </div>
          <div class="no-rating" *ngIf="!listing.averageRating">
            <i class="bi bi-star"></i>No reviews
          </div>
        </div>

        <div class="actions w-100">
          <button class="glass-btn primary book-btn" [routerLink]="['/booking/create', listing.id]">
            <i class="bi bi-bookmark-check"></i> Book Now
          </button>
        </div>
      </div>

      <!-- Main Details Card -->
      <div class="main-details glass-card">
        <div class="location-section">
          <h3><i class="bi bi-geo-alt"></i>Location</h3>
          <p class="location">{{ listing.location }}</p>
          <p class="destination">{{ listing.destination }}</p>
        </div>

        <div class="description-section">
          <h3>About this listing</h3>
          <p>{{ listing.description }}</p>
        </div>

        <!-- Property Details Grid -->
        <div class="property-details">
          <h3>Property Details</h3>
          <div class="details-grid">
            <div class="detail-item">
              <span class="label">Property Type</span>
              <span class="value">{{ listing.type }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Destination</span>
              <span class="value">{{ listing.destination }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Bedrooms</span>
              <span class="value">{{ listing.bedrooms || 'N/A' }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Bathrooms</span>
              <span class="value">{{ listing.bathrooms || 'N/A' }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Max Guests</span>
              <span class="value">{{ listing.maxGuests }}</span>
            </div>
          </div>
        </div>

        <!-- Amenities -->
        <div *ngIf="listing.amenities && listing.amenities.length > 0" class="amenities-section">
          <h3>Amenities</h3>
          <div class="amenities-grid">
            <span *ngFor="let amenity of listing.amenities" class="amenity-tag">
              <i class="bi bi-check-circle-fill"></i>{{ amenity }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Location Map Section -->
    <div class="location-section glass-card">
      <h3><i class="bi bi-geo-fill"></i>Location Details</h3>
      <div class="location-content">
        <div class="location-info">
          <p><strong>Address:</strong> {{ listing.location }}</p>
          <p><strong>Destination:</strong> {{ listing.destination }}</p>
        </div>
        <div id="detail-map" class="detail-map mb-4"></div>
      </div>
    </div>
  </div>
</div>

<!-- Reviews Section -->
<div class="reviews-section glass-card p-5">
  <div class="reviews-header">
    <h2><i class="bi bi-star-fill"></i>Guest Reviews</h2>

    <!-- Overall Rating Summary -->
    <div class="overall-rating">
      <div class="rating-display">
        <div class="rating-number">4.8</div>
        <div class="stars">
          <div class="star-rating">
            <div class="stars-background">
              <i class="bi bi-star"></i>
              <i class="bi bi-star"></i>
              <i class="bi bi-star"></i>
              <i class="bi bi-star"></i>
              <i class="bi bi-star"></i>
            </div>
            <div class="stars-filled" style="width: 96%">
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-fill"></i>
            </div>
          </div>
          <div class="review-count">24 reviews</div>
        </div>
      </div>

      <!-- Rating Breakdown -->
      <div class="rating-breakdown">
        <div class="breakdown-item">
          <span class="rating-label">5 stars</span>
          <div class="rating-bar">
            <div class="rating-fill" style="width: 75%"></div>
          </div>
          <span class="rating-count">18</span>
        </div>
        <div class="breakdown-item">
          <span class="rating-label">4 stars</span>
          <div class="rating-bar">
            <div class="rating-fill" style="width: 16.7%"></div>
          </div>
          <span class="rating-count">4</span>
        </div>
        <div class="breakdown-item">
          <span class="rating-label">3 stars</span>
          <div class="rating-bar">
            <div class="rating-fill" style="width: 8.3%"></div>
          </div>
          <span class="rating-count">2</span>
        </div>
        <div class="breakdown-item">
          <span class="rating-label">2 stars</span>
          <div class="rating-bar">
            <div class="rating-fill" style="width: 0%"></div>
          </div>
          <span class="rating-count">0</span>
        </div>
        <div class="breakdown-item">
          <span class="rating-label">1 star</span>
          <div class="rating-bar">
            <div class="rating-fill" style="width: 0%"></div>
          </div>
          <span class="rating-count">0</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Review Form -->
  <div class="review-form-section">
    <h3>Write a Review</h3>
    <form class="review-form">
      <!-- Rating Selection -->
      <div class="form-group">
        <label>Overall Rating</label>
        <div class="rating-selector">
          <button type="button" class="star-btn active">
            <i class="bi bi-star-fill"></i>
          </button>
          <button type="button" class="star-btn active">
            <i class="bi bi-star-fill"></i>
          </button>
          <button type="button" class="star-btn active">
            <i class="bi bi-star-fill"></i>
          </button>
          <button type="button" class="star-btn active">
            <i class="bi bi-star-fill"></i>
          </button>
          <button type="button" class="star-btn">
            <i class="bi bi-star"></i>
          </button>
        </div>

        <!-- Submit Button -->
        <div class="form-actions">
          <button type="submit" class="glass-btn primary">
            <i class="bi bi-send-fill"></i>Submit Review
          </button>
        </div>
      </div>

      <!-- Review Comment -->
      <div class="form-group">
        <label for="comment">Review</label>
        <textarea id="comment" rows="5" placeholder="Share details of your experience at this property..."
          class="glass-input">The property was even better than the photos! The host was very responsive and the location was perfect for exploring the city. Would definitely stay here again.</textarea>
      </div>


    </form>
  </div>

  <!-- Reviews List -->
  <div class="reviews-list">

    <div class="review-cards">
      <!-- Review 1 -->
      <div class="review-card">
        <div class="review-header">
          <div class="reviewer-info">
            <div class="reviewer-avatar">
              S
            </div>
            <div class="reviewer-details">
              <div class="reviewer-name">Sarah Johnson</div>
              <!-- <div class="review-date">March 15, 2024</div> -->
            </div>
          </div>
          <div class="review-rating">
            <div class="star-display">
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-fill"></i>
            </div>
            <span class="rating-value">5.0</span>
          </div>
        </div>

        <div class="review-content">
          <!-- <h4 class="review-title">Perfect getaway spot!</h4> -->
          <p class="review-comment">Absolutely loved our stay here! The property was clean, modern, and had everything
            we needed. The view from the balcony was breathtaking, especially during sunrise. The host was very
            responsive and provided great local recommendations.</p>
        </div>
      </div>

      <!-- Review 2 -->
      <div class="review-card">
        <div class="review-header">
          <div class="reviewer-info">
            <div class="reviewer-avatar">
              M
            </div>
            <div class="reviewer-details">
              <div class="reviewer-name">Mike Chen</div>
            </div>
          </div>
          <div class="review-rating">
            <div class="star-display">
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star"></i>
            </div>
            <span class="rating-value">4.0</span>
          </div>
        </div>

        <div class="review-content">
          <p class="review-comment">Very comfortable stay with excellent amenities. The location is convenient with good
            transportation links. The only minor issue was the Wi-Fi speed, but everything else was perfect. Would
            recommend for business travelers.</p>
        </div>
      </div>

      <!-- Review 3 -->
      <div class="review-card">
        <div class="review-header">
          <div class="reviewer-info">
            <div class="reviewer-avatar">
              E
            </div>
            <div class="reviewer-details">
              <div class="reviewer-name">Emma Rodriguez</div>
            </div>
          </div>
          <div class="review-rating">
            <div class="star-display">
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star"></i>
              <i class="bi bi-star"></i>
            </div>
            <span class="rating-value">3.0</span>
          </div>
        </div>

        <div class="review-content">
          <p class="review-comment">The property has great potential but there were some maintenance issues during our
            stay. The air conditioning wasn't working properly and some kitchen appliances were outdated. However, the
            host was very apologetic and offered a partial refund.</p>
        </div>
      </div>
    </div>

    <!-- Load More Button -->
    <div class="load-more">
      <button class="glass-btn">
        <i class="bi bi-arrow-down"></i> Load More Reviews
      </button>
    </div>
  </div>
</div>
<div class="row m-5">

  <!-- LISTINGS (10 columns) -->
  <div class="col-10">
    <div class="row listings-row p-3 py-4">
      <div class="cards-list">
        <a *ngFor="let l of filtered(); trackBy: trackById" [routerLink]="['/listings', l.id]"
          class="text-decoration-none card-link">
          <div class="card listing-card">

            <!-- Fixed image wrapper always on top -->
            <div class="image-wrapper position-relative">
              <img [src]="l.mainImageUrl 
            ? (l.mainImageUrl.indexOf('http') === 0 
              ? l.mainImageUrl 
              : 'http://localhost:5235' + l.mainImageUrl)
            : 'assets/default-listing.svg'" class="card-img-top" [alt]="l.title" />

              <div class="overlay"></div>

              <div class="position-absolute top-0 start-0 m-2 d-flex gap-2 flex-wrap">
                <span class="badge" *ngIf="!l.isApproved">Pending</span>
                <span class="badge" *ngIf="l.isApproved">Approved</span>
              </div>

              <div class="rate position-absolute top-0 end-0 m-2 d-flex align-items-center">
                <i class="bi bi-star-fill me-1"></i> {{ l.averageRating || 0 }}
              </div>
            </div>

            <!-- Always below the image -->
            <div class="card-body">
              <h5 class="title fw-semibold">{{ l.title }}</h5>

              <p class="location text-muted medium">
                {{ l.destination }}
              </p>

              <p class="type text-muted small">
                {{ l.bedrooms || 0 }} Bedroom â€¢ {{ l.bathrooms || 0 }} Bath
              </p>

              <div class="bottom d-flex justify-content-between align-items-center">
                <span class="price fw-bold fs-6">
                  {{ l.pricePerNight }} EGP
                  <span class="fs-7 fw-normal text-muted">/ night</span>
                </span>

                <div class="btn-group btn-group-sm">
                  <a class="btn btn-outline-light" [routerLink]="['/listings', l.id]">
                    <i class="bi bi-eye"></i>
                  </a>
                  <a class="btn btn-outline-primary" [routerLink]="['/host', l.id, 'edit']">
                    <i class="bi bi-pencil"></i>
                  </a>
                  <button class="btn btn-outline-danger" (click)="$event.preventDefault(); onDelete(l.id)">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </div>
            </div>

          </div>
        </a>
      </div>
    </div>
  </div>

  <div class="col-2">
    <!-- Sidebar Wrapper to contain both filters and add button -->
    <div class="sidebar-wrapper">

      <!-- Filters Sidebar -->
      <div class="filters-sidebar glass-card p-4 d-flex flex-column">
        <div class="sidebar-content flex-grow-1">
          <!-- Your existing filter content here -->
          <!-- 1. Search -->
          <div class="search-wrap mb-3">
            <i class="bi bi-search"></i>
            <input class="search-input" type="text" placeholder="Search..." [ngModel]="search()"
              (ngModelChange)="search.set($event)" />
          </div>

          <!-- 2. Destination -->
          <div class="filter-block mb-3">
            <select class="form-select fancy-input" [ngModel]="destination()" (ngModelChange)="destination.set($event)">
              <option value="">All Destinations</option>
              <option *ngFor="let dest of destinations()" [value]="dest">{{ dest }}</option>
            </select>
          </div>

          <!-- 3. Type -->
          <div class="filter-block mb-3">
            <select class="form-select fancy-input" [ngModel]="type()" (ngModelChange)="type.set($event)">
              <option value="">All Types</option>
              <option *ngFor="let t of types()" [value]="t">{{ t }}</option>
            </select>
          </div>

          <!-- 4. Status -->
          <div class="filter-block mb-3">
            <select class="form-select fancy-input" [ngModel]="isApproved()" (ngModelChange)="isApproved.set($event)">
              <option value="">All Status</option>
              <option value="approved">Approved</option>
              <option value="not-approved">Not Approved</option>
            </select>
          </div>

          <!-- 5. Max Price -->
          <div class="filter-block mb-3">
            <input type="number" placeholder="Max Price" class="form-control fancy-input" [ngModel]="maxPrice()"
              (ngModelChange)="maxPrice.set($event === '' ? null : +$event)">
          </div>

          <!-- 6. Min Rate -->
          <div class="filter-block">
            <input type="number" placeholder="Min Rate" class="form-control fancy-input" min="0" max="5" step="0.5"
              [ngModel]="minRating()" (ngModelChange)="minRating.set($event === '' ? null : +$event)">
          </div>

          <div class="text-center text-white-50 small mt-4">
            {{ filtered().length }} results
          </div>

          <!-- Reset at bottom -->
          <button class="btn btn-outline-light w-100 mt-auto mb-2" (click)="resetFilters()">Reset</button>
        </div>
      </div>

      <!-- Add Listing Button - NOW INSIDE the sidebar wrapper -->
      <a class="add-listing-btn" [routerLink]="['/host/create']">
        + Add Listing
      </a>

    </div>
  </div>
</div>